
#include <machine.h>
#include "types.h"
#include "SYSTEM.h"

short cel_tbl[2] = {0x2000, 0x2000};
short map_tbl[2] = {0x1000, 0x1800};
short spr_tbl[2] = {0x0200, 0x2000};
u16 nbg_disp[2] = {0, 0};
u16 spr_disp = 0;
u16 nbg_xoff[2] = {0, 0};
u16 nbg_yoff[2] = {0, 0};
u8 lcd_option = 0;
u16 colpal[16][4] = {
	{ 0x0007, 0x0005, 0x0003, 0x0000, },
	{ 0x0007, 0x0006, 0x0005, 0x0004, },
	{ 0x0005, 0x0004, 0x0003, 0x0002, },
	{ 0x0003, 0x0002, 0x0001, 0x0000, },
	{ 0x0007, 0x0004, 0x0000, 0x0000, },
	{ 0x0003, 0x0004, 0x0005, 0x0007, },
	{ 0x0003, 0x0002, 0x0001, 0x0000, },
	{ 0x0007, 0x0005, 0x0003, 0x0000, },
	{ 0x0007, 0x0005, 0x0003, 0x0000, },
	{ 0x0007, 0x0006, 0x0005, 0x0004, },
	{ 0x0005, 0x0004, 0x0003, 0x0002, },
	{ 0x0003, 0x0002, 0x0001, 0x0000, },
	{ 0x0007, 0x0004, 0x0000, 0x0000, },
	{ 0x0006, 0x0004, 0x0002, 0x0000, },
	{ 0x0007, 0x0005, 0x0003, 0x0000, },
	{ 0x0000, 0x0004, 0x0007, 0x0000, },
};
u8 vram[276] = {
    0x00, 0x00, 0x00, 0x00, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x25, 0x30, 0x34, 0x58, 0x3A, 0x00, 0x46, 0x41, 0x53, 0x54, 0x3A, 0x00, 0x65, 0x72,
    0x72, 0x2E, 0x3A, 0x00, 0x25, 0x30, 0x34, 0x58, 0x3A, 0x00, 0x65, 0x72, 0x72, 0x2E, 0x3A, 0x00,
    0x45, 0x4E, 0x44, 0x2E, 0x3A, 0x00, 0x25, 0x30, 0x34, 0x58, 0x3A, 0x00, 0x25, 0x30, 0x34, 0x58,
    0x3A, 0x00, 0x46, 0x52, 0x45, 0x45, 0x00, 0x00, 0x55, 0x53, 0x45, 0x2E, 0x00, 0x00, 0x65, 0x72,
    0x72, 0x2E, 0x00, 0x00, 0x3E, 0x2D, 0x2D, 0x3D, 0x5B, 0x20, 0x20, 0x4D, 0x65, 0x6D, 0x6F, 0x72,
    0x79, 0x20, 0x49, 0x6E, 0x69, 0x74, 0x2E, 0x20, 0x5D, 0x3D, 0x3D, 0x2D, 0x2D, 0x3C, 0x00, 0x00,
    0x2E, 0x00, 0x25, 0x31, 0x64, 0x2E, 0x25, 0x30, 0x32, 0x64, 0x00, 0x00, 0x25, 0x30, 0x33, 0x64,
    0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x25, 0x30, 0x34, 0x58, 0x00, 0x00,
    0x25, 0x30, 0x34, 0x58, 0x00, 0x00, 0x25, 0x30, 0x34, 0x58, 0x00, 0x00, 0x25, 0x30, 0x34, 0x58,
    0x00, 0x00, 0x25, 0x30, 0x34, 0x58, 0x00, 0x00, 0x25, 0x30, 0x34, 0x58, 0x00, 0x00, 0x25, 0x30,
    0x34, 0x58, 0x00, 0x00, 0x25, 0x30, 0x34, 0x58, 0x00, 0x00, 0x25, 0x30, 0x34, 0x58, 0x00, 0x00,
    0x25, 0x30, 0x34, 0x58, 0x00, 0x00, 0x25, 0x30, 0x34, 0x58, 0x00, 0x00, 0x25, 0x30, 0x33, 0x58,
    0x00, 0x00, 0x25, 0x30, 0x34, 0x58, 0x00, 0x00, 0x25, 0x30, 0x34, 0x58, 0x00, 0x00, 0x20, 0x00,
    0x3E, 0x00, 0x20, 0x00, 0x6D, 0x61, 0x78, 0x3D, 0x25, 0x32, 0x64, 0x00, 0x25, 0x32, 0x64, 0x00,
    0x25, 0x32, 0x64, 0x00 
};
u8 com_user[1012] = {
    0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x49, 0x50, 0x5F, 0x4D, 0x45, 0x53, 0x20, 0x74, 0x65, 0x73,
    0x74, 0x20, 0x70, 0x72, 0x6F, 0x67, 0x72, 0x61, 0x6D, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x6C, 0x65, 0x76, 0x65, 0x6C,
    0x31, 0x2E, 0x30, 0x30, 0x00, 0x00, 0x2D, 0x20, 0x45, 0x6E, 0x74, 0x72, 0x79, 0x4C, 0x69, 0x73,
    0x74, 0x20, 0x2D, 0x20, 0x4E, 0x6F, 0x3A, 0x49, 0x70, 0x3A, 0x4C, 0x6E, 0x3A, 0x4D, 0x61, 0x20,
    0x2D, 0x00, 0x25, 0x64, 0x3A, 0x25, 0x64, 0x2E, 0x25, 0x64, 0x2E, 0x25, 0x64, 0x2E, 0x25, 0x64,
    0x3A, 0x25, 0x64, 0x3A, 0x25, 0x64, 0x00, 0x00, 0x2D, 0x20, 0x75, 0x73, 0x65, 0x64, 0x3A, 0x25,
    0x64, 0x20, 0x2D, 0x20, 0x66, 0x72, 0x65, 0x65, 0x3A, 0x25, 0x64, 0x20, 0x2D, 0x20, 0x6D, 0x61,
    0x78, 0x3A, 0x25, 0x64, 0x20, 0x2D, 0x00, 0x00, 0x49, 0x6E, 0x69, 0x74, 0x69, 0x61, 0x6C, 0x69,
    0x7A, 0x65, 0x20, 0x52, 0x49, 0x47, 0x48, 0x54, 0x2B, 0x4C, 0x45, 0x46, 0x54, 0x2B, 0x41, 0x00,
    0x62, 0x75, 0x74, 0x74, 0x6F, 0x6E, 0x20, 0x70, 0x75, 0x73, 0x68, 0x00, 0x3E, 0x2D, 0x2D, 0x3D,
    0x5B, 0x20, 0x20, 0x49, 0x70, 0x6D, 0x65, 0x73, 0x20, 0x49, 0x6E, 0x69, 0x74, 0x2E, 0x20, 0x5D,
    0x3D, 0x3D, 0x2D, 0x2D, 0x3C, 0x00, 0x25, 0x30, 0x34, 0x58, 0x3A, 0x25, 0x30, 0x34, 0x58, 0x00,
    0x03, 0x00, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x02, 0x00, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x56, 0x45, 0x52, 0x53,
    0x49, 0x4F, 0x4E, 0x20, 0x30, 0x30, 0x30, 0x31, 0x30, 0x35, 0x44, 0x00, 0x46, 0x52, 0x45, 0x45,
    0x20, 0x50, 0x4C, 0x41, 0x59, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x41, 0x4C, 0x4C, 0x20,
    0x53, 0x41, 0x56, 0x45, 0x20, 0x43, 0x4C, 0x45, 0x41, 0x52, 0x21, 0x00, 0x55, 0x4E, 0x44, 0x45,
    0x46, 0x49, 0x4E, 0x45, 0x44, 0x21, 0x21, 0x20, 0x20, 0x20, 0x20, 0x00, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x54, 0x59, 0x50, 0x45,
    0x20, 0x30, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x4E, 0x6F, 0x20, 0x53,
    0x75, 0x70, 0x70, 0x6F, 0x74, 0x65, 0x64, 0x20, 0x20, 0x20, 0x20, 0x00, 0x2D, 0x2D, 0x43, 0x4C,
    0x45, 0x41, 0x52, 0x2D, 0x2D, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x01, 0x02, 0xA8, 0xC0,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x05, 0x00, 0x00, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x02, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x03, 0x02,
    0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x05, 0x00, 0x04, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x05, 0x02, 0xA8, 0xC0, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00,
    0x06, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x07, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x08, 0x02, 0xA8, 0xC0,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x05, 0x00, 0x01, 0x02, 0xA8, 0xC0, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x01, 0x02, 0xA8, 0xC0, 0x04, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x01, 0x02,
    0xA8, 0xC0, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x05, 0x00, 0x01, 0x02, 0xA8, 0xC0, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x01, 0x02, 0xA8, 0xC0, 0x04, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00,
    0x06, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x07, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x05, 0x02, 0xA8, 0xC0,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x05, 0x00, 0x02, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x04, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x08, 0x02,
    0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x05, 0x00, 0x07, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x03, 0x02, 0xA8, 0xC0, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00,
    0x02, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x04, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x05, 0x02, 0xA8, 0xC0,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x05, 0x00, 0x06, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x07, 0x02, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x08, 0x02,
    0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x05, 0x00 
};
u8 effect_tbl[382] = {
    0x30, 0x00, 0x30, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0xF9, 0xD2, 0x18, 0x00, 0x28, 0x00,
    0x10, 0x00, 0x06, 0x00, 0x00, 0x00, 0xAD, 0xD3, 0x10, 0x00, 0x20, 0x00, 0x08, 0x00, 0x0B, 0x00,
    0x00, 0x00, 0x22, 0xD4, 0x30, 0x00, 0x30, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x60, 0xD4,
    0x20, 0x00, 0x30, 0x00, 0x10, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x67, 0xD5, 0x20, 0x00, 0x20, 0x00,
    0x08, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x2C, 0xD6, 0x18, 0x00, 0x28, 0x00, 0x00, 0x00, 0x0C, 0x00,
    0x00, 0x00, 0xB9, 0xD6, 0x20, 0x00, 0x20, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x44, 0xD7,
    0x18, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x9F, 0xD7, 0x20, 0x00, 0x20, 0x00,
    0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0xE4, 0xD7, 0x18, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0A, 0x00,
    0x00, 0x00, 0x33, 0xD8, 0x18, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x72, 0xD8,
    0x30, 0x00, 0x30, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0xDB, 0xD1, 0x00, 0x01, 0xA8, 0xC0,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x10, 0x00, 0x00, 0x01, 0xA8, 0xC0, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x01, 0xA8, 0xC0, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x01,
    0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x10, 0x00, 0x00, 0x01, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x25, 0x30, 0x32, 0x64, 0x00, 0x00,
    0x25, 0x30, 0x32, 0x64, 0x00, 0x00, 0x25, 0x30, 0x32, 0x64, 0x00, 0x00, 0x25, 0x30, 0x32, 0x64,
    0x00, 0x00, 0x2D, 0x2D, 0x00, 0x00, 0x25, 0x30, 0x32, 0x64, 0x00, 0x00, 0x25, 0x30, 0x32, 0x64,
    0x00, 0x00, 0x25, 0x30, 0x32, 0x64, 0x00, 0x00, 0x2D, 0x2D, 0x00, 0x00, 0x01, 0x01, 0xA8, 0xC0,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x04, 0x00, 0x01, 0x01, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x01, 0x01, 0xA8, 0xC0, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00 
};
u8 bitmap_nbg[6] = {
    0x00, 0x00, 0x01, 0x00, 0x00, 0x00
};
u8 _ctype[257] = {
    0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x28, 0x28, 0x28, 0x28, 0x28, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x88, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90,
    0x90, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0xC4, 0x90, 0x90, 0x90, 0x90, 0x90,
    0x90, 0x90, 0xC1, 0xC1, 0xC1, 0xC1, 0xC1, 0xC1, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81,
    0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0x90, 0x90, 0x90, 0x90,
    0x90, 0x90, 0xC2, 0xC2, 0xC2, 0xC2, 0xC2, 0xC2, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82,
    0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0x90, 0x90, 0x90, 0x90,
    0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00 
};
struct TaskContext tsk1cont;
s16 fade[2];

u16 nbg_ddf(u16 a, u16 b)
{
	if(b == 1 || b == 0)
	{
		nbg_disp[a] = b;
		outpw(0,(spr_disp<<2) | (nbg_disp[1] << 1) | nbg_disp[0]);
		return b;
	}
	else
	{
		return nbg_disp[a];
	}
}

u16 spr_ddf(u16 a)
{
	if(a == 1 || a == 0)
	{
		spr_disp = a;
		outpw(0,(spr_disp<<2) | (nbg_disp[1] << 1) | nbg_disp[0]);
		return a;
	}
	else
	{
		return spr_disp;
	}
}

void nbg_scroll(u16 a, u16 b, u16 c)
{
	nbg_xoff[a] = b;
	nbg_yoff[a] = c;

	switch(a)
	{
		case 0:
		{
			outp2(0x10,b);
			outp2(0x11,c);
			break;
		}
		case 1:
		{
			outp2(0x12,b);
			outp2(0x13,c);
			break;
		}
	}
}

void cls(u16 a)
{
	/*u16 *v = vram;
	u16 *m = map_tbl[a];
	s16 i;

	for(i = 0x400; i != 0; i--)
	{
		*m++ = 0x9FF;
	}

	m = cel_tbl[a] + 0x1ff0;
	for(i = 8; i != 0; i--)
	{
		*m++ = 0;
	}*/
	ASM_DB(0x55);
	ASM_DB(0x8b);
	ASM_DB(0xec);
	ASM_DB(0x83);
	ASM_DB(0xec);
	ASM_DB(0x04);
	ASM_DB(0x51);
	ASM_DB(0x52);
	ASM_DB(0x56);
	ASM_DB(0x8b);
	ASM_DB(0xf0);
	ASM_DB(0x8b);
	ASM_DB(0x1e);
	ASM_DB(0xf8);
	ASM_DB(0x00);
	ASM_DB(0x33);
	ASM_DB(0xc0);
	ASM_DB(0x8b);
	ASM_DB(0xc3);
	ASM_DB(0x33);
	ASM_DB(0xc9);
	ASM_DB(0x8b);
	ASM_DB(0xde);
	ASM_DB(0xd1);
	ASM_DB(0xe3);
	ASM_DB(0x8b);
	ASM_DB(0x97);
	ASM_DB(0x60);
	ASM_DB(0x00);
	ASM_DB(0x33);
	ASM_DB(0xdb);
	ASM_DB(0x0b);
	ASM_DB(0xca);
	ASM_DB(0x0b);
	ASM_DB(0xc3);
	ASM_DB(0x89);
	ASM_DB(0x4e);
	ASM_DB(0xfc);
	ASM_DB(0x89);
	ASM_DB(0x46);
	ASM_DB(0xfe);
	ASM_DB(0xb8);
	ASM_DB(0x00);
	ASM_DB(0x04);
	ASM_DB(0xeb);
	ASM_DB(0x10);
	ASM_DB(0x83);
	ASM_DB(0x46);
	ASM_DB(0xfc);
	ASM_DB(0x02);
	ASM_DB(0xc4);
	ASM_DB(0x5e);
	ASM_DB(0xfc);
	ASM_DB(0x83);
	ASM_DB(0xeb);
	ASM_DB(0x02);
	ASM_DB(0x26);
	ASM_DB(0xc7);
	ASM_DB(0x07);
	ASM_DB(0xff);
	ASM_DB(0x09);
	ASM_DB(0x48);
	ASM_DB(0x85);
	ASM_DB(0xc0);
	ASM_DB(0x75);
	ASM_DB(0xec);
	ASM_DB(0x8b);
	ASM_DB(0x1e);
	ASM_DB(0xf8);
	ASM_DB(0x00);
	ASM_DB(0x33);
	ASM_DB(0xc0);
	ASM_DB(0x8b);
	ASM_DB(0xc3);
	ASM_DB(0x33);
	ASM_DB(0xdb);
	ASM_DB(0xd1);
	ASM_DB(0xe6);
	ASM_DB(0x8b);
	ASM_DB(0x94);
	ASM_DB(0x5c);
	ASM_DB(0x00);
	ASM_DB(0x81);
	ASM_DB(0xc2);
	ASM_DB(0xf0);
	ASM_DB(0x1f);
	ASM_DB(0x33);
	ASM_DB(0xc9);
	ASM_DB(0x0b);
	ASM_DB(0xda);
	ASM_DB(0x0b);
	ASM_DB(0xc1);
	ASM_DB(0x89);
	ASM_DB(0x5e);
	ASM_DB(0xfc);
	ASM_DB(0x89);
	ASM_DB(0x46);
	ASM_DB(0xfe);
	ASM_DB(0xb8);
	ASM_DB(0x08);
	ASM_DB(0x00);
	ASM_DB(0xeb);
	ASM_DB(0x10);
	ASM_DB(0x83);
	ASM_DB(0x46);
	ASM_DB(0xfc);
	ASM_DB(0x02);
	ASM_DB(0xc4);
	ASM_DB(0x5e);
	ASM_DB(0xfc);
	ASM_DB(0x83);
	ASM_DB(0xeb);
	ASM_DB(0x02);
	ASM_DB(0x26);
	ASM_DB(0xc7);
	ASM_DB(0x07);
	ASM_DB(0x00);
	ASM_DB(0x00);
	ASM_DB(0x48);
	ASM_DB(0x85);
	ASM_DB(0xc0);
	ASM_DB(0x75);
	ASM_DB(0xec);
	ASM_DB(0x5e);
	ASM_DB(0x5a);
	ASM_DB(0x59);
	ASM_DB(0x8b);
	ASM_DB(0xe5);
	ASM_DB(0x5d);
}

void spr_cls()
{
	s16 i;
    
    for (i = 0; i < 0x80; i++)
    {
        put_sprite(i, 0xe0, 0x90, 0, 0);
    }
}

void SetPaletteRate(u16 a)
{
	u16 *f = fade;
	u16 c1,c2,c3,c4,c5;

	c1 = (((colpal[a][0] * f[0]) / 100) & 0xF);
	c2 = (((colpal[a][1] * f[0]) / 100) & 0xF);
	c3 = (((colpal[a][2] * f[0]) / 100) & 0xF);
	c4 = (((colpal[a][3] * f[0]) / 100) & 0xF);

	c5 = c1 << 12 | c2 << 8 | c3 << 4 | c4 << 0;

	switch(a)
	{
		case 0:
		{
			outpw(0x20,c5);
			break;
		}
		case 1:
		{
			outpw(0x22,c5);
			break;
		}
		case 2:
		{
			outpw(0x24,c5);
			break;
		}
		case 3:
		{
			outpw(0x26,c5);
			break;
		}
		case 4:
		{
			outpw(0x28,c5);
			break;
		}
		case 5:
		{
			outpw(0x2A,c5);
			break;
		}
		case 6:
		{
			outpw(0x2C,c5);
			break;
		}
		case 7:
		{
			outpw(0x2E,c5);
			break;
		}
		case 8:
		{
			outpw(0x30,c5);
			break;
		}
		case 9:
		{
			outpw(0x32,c5);
			break;
		}
		case 10:
		{
			outpw(0x34,c5);
			break;
		}
		case 11:
		{
			outpw(0x36,c5);
			break;
		}
		case 12:
		{
			outpw(0x38,c5);
			break;
		}
		case 13:
		{
			outpw(0x3A,c5);
			break;
		}
		case 14:
		{
			outpw(0x3C,c5);
			break;
		}
		case 15:
		{
			outpw(0x3E,c5);
			break;
		}
	}
}

void SetPalette(u16 a, u16 b, u16 c, u16 d, u16 e)
{
	colpal[a][0] = b & 7;
	colpal[a][1] = c & 7;
	colpal[a][2] = d & 7;
	colpal[a][3] = e & 7;
	SetPaletteRate(a);
}

void fade_run()
{
	s16 *f = fade;
	s16 i;
	if(f[1])
	{
		f[0] += f[1];
		if(f[0] < 0)
		{
			f[0] = 0;
			f[1] = 0;
		}
		if(f[0] > 100)
		{
			f[0] = 100;
			f[1] = 0;
		}
		for(i = 0; i < 16; i++)
		{
			SetPaletteRate(i);
		}
	}
}

void fade_tone(s16 unk)
{
	fade[0] = unk;
}

void fade_in(s16 unk)
{
    if(unk <= 0)
    {
        unk = -unk;
    }
    fade[1] = unk;
}

void fade_out(s16 unk)
{
    if(unk <= 0)
    {
        unk = -unk;
    }
    fade[1] = -unk;
}

void lcd_option_1(u16 a)
{
	lcd_option = (lcd_option & 0x1F) | (a << 5);
}

void lcd_option_2(u16 a)
{
	lcd_option = (lcd_option & 0x2F) | (a << 4);
}

void lcd_option_3(u16 a)
{
	lcd_option = (lcd_option & 0x37) | (a << 3);
}

void init_system()
{
	outp2(0x07, 0x32);
    outp2(0x10, 0x00);
    outp2(0x11, 0x00);
    outp2(0x12, 0x00);
    outp2(0x13, 0x00);
    outp2(0x04, 0x01);
    outp2(0x05, 0x00);
    outp2(0x06, 0x80);
    outpw(0x00, 0x00);
    fade_tone(100);
    fade_in(100);
    fade_run();
    outp2(0x14, 0x01);
    lcd_option = 4;
    outp2(0x15,lcd_option);
    outp2(0x1C, 0x20);
    outp2(0x1D, 0x64);
    outp2(0x1E, 0xA8);
    outp2(0x1F, 0xFC);
    interrupt_init();
    serial_init();
    sound_init();
    serial_send_cause(0);
    key_create_cause(0);
    casette_int_cause(0);
    serial_receive_cause(1);
    display_data_cause(0);
    v_brank_cnt_cause(1);
    v_brank_int_cause(1);
    h_brank_cnt_cause(0);
    ip_init();
}

